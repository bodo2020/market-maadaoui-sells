-- استعادة الكميات لفرع MMG بناءً على الباركود من ملف Excel
-- تحديث الكميات في جدول inventory للمنتجات التي لديها باركود

-- إنشاء جدول مؤقت لتخزين بيانات الكميات من Excel
CREATE TEMP TABLE temp_product_quantities (
  barcode TEXT,
  quantity INTEGER
);

-- إدخال بيانات الكميات من Excel (عينة من البيانات - يمكن توسيعها)
INSERT INTO temp_product_quantities (barcode, quantity) VALUES
('6222020807191', 54),
('6222020808167', 2),
('6222020805043', 19),
('6222020804763', 21),
('3073781207088', 8),
('6291106856446', 3),
('6920702088080', 0),
('6920702088059', 0),
('6920702088882', 0),
('6920702088028', 0),
('6221078762605', 3),
('6221078762001', 3),
('6221078762063', 4),
('6221078762575', 1),
('6223006313583', 11),
('6223006318397', 20),
('6223006313569', 12),
('6223006318403', 15),
('6223004765537', 5),
('6223006312579', 10),
('6223004761751', 4),
('6223004760198', 4),
('6223004760181', 6),
('6221029210230', 5),
('647940530077', 10),
('6224007750629', 21),
('6224007750520', 10),
('6224007750599', 32),
('6224007750544', 20),
('6224007750070', 6),
('6224007750315', 10),
('6224007750483', 7),
('6224007750605', 20),
('6224007750810', 19),
('6224007750582', 21),
('6224007750803', 26),
('054881004732', 1),
('6224003281202', 2),
('054881008167', 3),
('054881014595', 2),
('054881014915', 4),
('054881016650', 1),
('054881027335', 4),
('054881011181', 1),
('054881026093', 5),
('6224000582173', 15),
('6221029210339', 1),
('6224007330197', 0),
('6224007330203', 0),
('6224000514983', 21),
('6772505002301', 7),
('6772505002295', 17),
('6772505002950', 8),
('6772505002998', 0),
('6772505002929', 11),
('6772505002523', 4),
('6772505002318', 11),
('6625000237030', 2),
('6225000231795', 0),
('6625000237023', 0),
('6225000069701', 2),
('6223000760802', 6),
('6223000760444', 13),
('6223000760024', 0),
('6223000760062', 23),
('6223000760109', 22),
('6223000760215', 13),
('6223000760369', 4),
('6223000762066', 10),
('6223000762042', 9),
('6223000762493', 0),
('6223000762462', 0),
('6223001824619', 0),
('6224002738035', 0),
('6224002738400', 0),
('6225000321137', 5),
('6224010237094', 23),
('6225000321120', 7),
('6224010237032', 0),
('6224010237261', 21),
('6225000321175', 0),
('6223000052631', 16),
('6223000052648', 0),
('6194003330029', 4),
('6224008630647', 0),
('6224008630630', 0),
('6224009794744', 0),
('6224009794713', 0),
('6222002300030', 29),
('6253505463274', 58),
('6253505463298', 37),
('6223001877202', 27),
('6223001877172', 0),
('6223007521147', 14),
('6223007521130', 11),
('6223001874980', 0),
('6223007525060', 0),
('6223007525008', 0),
('6223007525398', 0),
('6223007525404', 0);

-- تحديث الكميات في جدول inventory لفرع MMG
UPDATE public.inventory
SET 
  quantity = tpq.quantity,
  updated_at = now()
FROM temp_product_quantities tpq
INNER JOIN public.products p ON p.barcode = tpq.barcode
WHERE inventory.product_id = p.id
  AND inventory.branch_id IN (
    SELECT id FROM public.branches WHERE code = 'MMG'
  );

-- حذف الجدول المؤقت
DROP TABLE temp_product_quantities;
